/*****************************************************************************
 * Project: BaBar detector at the SLAC PEP-II B-factory
 * Package: RooFitCore
 *    File: $Id: RooFitContext.rdl,v 1.1 2001/05/03 02:15:55 verkerke Exp $
 * Authors:
 *   DK, David Kirkby, Stanford University, kirkby@hep.stanford.edu
 *   WV, Wouter Verkerke, UC Santa Barbara, verkerke@slac.stanford.edu
 * History:
 *   07-Mar-2001 WV Created initial version
 *
 * Copyright (C) 2001 University of California
 *****************************************************************************/

#ifndef ROO_FIT_CONTEXT
#define ROO_FIT_CONTEXT

#include <iostream.h>
#include "TNamed.h"
#include "RooFitCore/RooPrintable.hh"

class RooAbsPdf ;
class RooDataSet ;
class RooArgSet ;


class RooFitContext : public TNamed, public RooPrintable {
public:

  // Constructors, assignment etc
  RooFitContext(const RooDataSet* data, const RooAbsPdf* pdf) ;
  virtual ~RooFitContext() ;

  Int_t fit(Option_t *options = "", Double_t *minValue= 0) ;  

  inline RooAbsPdf* pdf() const { return _pdfClone; }
  inline RooDataSet* data() const { return _dataClone ; }
  inline Int_t getNPar() const { return _nPar ; }
  inline ofstream* logfile() const { return _logfile ; }
  inline Bool_t extendedMode() const { return _extendedMode ; }
  inline Double_t& maxNLL() { return _maxNLL ; }

  virtual void printToStream(ostream &os, PrintOption opt= Standard, TString indent= "") const ;
  inline virtual void Print(Option_t *options= 0) const {
    printToStream(defaultStream(),parseOptions(options));
  }

protected:

  // Parameter accessors by ordinal index
  friend void RooFitGlue(Int_t &np, Double_t *gin, Double_t &f, Double_t *par, Int_t flag) ;
  Double_t getPdfParamVal(Int_t index) ;
  Double_t getPdfParamErr(Int_t index) ;	
  void setPdfParamVal(Int_t index, Double_t value) ;
  void setPdfParamErr(Int_t index, Double_t value) ;
  
  // Prefit optimizer
  Bool_t optimizePdf(RooAbsPdf* pdf, RooDataSet* dset) ;
  Bool_t findCacheableBranches(RooAbsPdf* pdf, RooDataSet* dset, RooArgSet& cacheList) ;

public:
  
  RooDataSet* _dataClone ;
  RooArgSet*  _pdfCompList ;
  RooAbsPdf*  _pdfClone ;
  RooArgSet*  _paramList ;
  Int_t       _nPar ;

  Double_t _maxNLL ;  
  Bool_t _extendedMode ;
  ofstream* _logfile ;

protected:

  ClassDef(RooFitContext,0) // Non-persistable fit context
} ;

#endif
