#!/usr/bin/make -f 
#
#
LPATH	= $(PREFIX)/lib/root
IPATH	= $(PREFIX)/include/root
BPATH	= $(PREFIX)/bin
MPATH   = $(PREFIX)/share/man/man1
SOEXT	= so
MAJOR   = $(shell echo $(VERSION) | tr '.' ' ' | cut -f1 -d' ')
MINOR   = $(shell echo $(VERSION) | tr '.' ' ' | cut -f2 -d' ')
SOVER	= $(MAJOR).$(MINOR)

ifneq ($(DIRS),)
include config/Makefile.config 
include $(foreach i, $(DIRS), $(i)/Module.mk)
endif

ifneq ($(DEV),)
PKGHDRS:=$(shell echo $(ALLHDRS) | sed -e 's,[^ ]*inc/,include/,g' -e 's,include/,usr/include/root/,g')
endif

ifneq ($(PKG),)
PKGLIBS=$(ALLLIBS:%.so=%.so*)
PKGBINS=$(ALLEXECS:bin/%=usr/bin/%)
endif

all:	liblist devlist binlist

ifneq ($(LIB),)
ifneq ($(LIB),$(DEV))
PKGLIBS	:= $(ALLLIBS:$(PREFIX)/lib/root/%=$(PREFIX)/lib/root/$(SOVER)/%.$(SOVER)) \
	   $(ALLLIBS:$(PREFIX)/lib/root/%=$(PREFIX)/lib/root/$(SOVER)/%.$(MAJOR)) \
	   $(ALLLIBS:$(PREFIX)/lib/root/%=$(PREFIX)/lib/root/$(SOVER)/%) \
	   $(ALLLIBS:$(PREFIX)/lib/root/%=$(PREFIX)/lib/root/%.$(SOVER)) 
DEVLIBS := $(ALLLIBS) 
else # ! $(LIB) = $(DEV)
ifneq ($(NOVERS),1)
ifeq ($(DIRS), cint)
PKGLIBS	:= $(ALLLIBS:$(PREFIX)/lib/root/%=$(PREFIX)/lib/root/$(SOVER)/%.$(SOVER)) \
	   $(ALLLIBS:$(PREFIX)/lib/root/%=$(PREFIX)/lib/root/$(SOVER)/%.$(MAJOR)) \
	   $(ALLLIBS:$(PREFIX)/lib/root/%=$(PREFIX)/lib/root/$(SOVER)/%) \
	   $(ALLLIBS:$(PREFIX)/lib/root/%=$(PREFIX)/lib/root/%.$(SOVER)) \
	   $(ALLLIBS)
else # ! $(DIRS) = cint
PKGLIBS	:= $(ALLLIBS:$(PREFIX)/lib/root/%=$(PREFIX)/lib/root/$(SOVER)/%.$(SOVER)) \
	   $(ALLLIBS:$(PREFIX)/lib/root/%=$(PREFIX)/lib/root/$(SOVER)/%.$(MAJOR)) \
	   $(ALLLIBS:$(PREFIX)/lib/root/%=$(PREFIX)/lib/root/$(SOVER)/%) 
endif # $(DIRS) = cint
else # ! $(NOVERS) != 1
ifeq ($(DIRS), xrootd)
XRDLIBS := $(patsubst lib/%, $(LPATH)/%, \
		$(filter-out lib/libXrdProofd.so, $(wildcard lib/libXrd*.so)))
PKGLIBS	:= $(XRDLIBS:$(PREFIX)/lib/root/%=$(PREFIX)/lib/root/$(SOVER)/%)
else  # ! $(LIB)
PKGLIBS	:= $(ALLLIBS) \
	   $(ALLLIBS:$(PREFIX)/lib/root/%=$(PREFIX)/lib/root/$(SOVER)/%) \
	   $(ALLLIBS:$(PREFIX)/lib/root/%=$(PREFIX)/lib/root/%.$(SOVER))
endif # $(DIRS) = xrootd
endif # $(NOVERS) != 1
endif # $(LIB) = $(DEV)
liblist:
	@for f in $(PKGLIBS)  ; do echo $$f ; done >> $(OUT)/$(LIB).install
ifneq ($(LIB),$(DEV))
	@(cd $(BUILD)/$(PREFIX)/lib/root && \
	   for i in $(ALLLIBS) ; do \
	      b=`basename $$i` ; \
	      ln -fs $(SOVER)/$$b . ; \
	      ln -fs $(SOVER)/$$b.$(SOVER) .; done)
else 
ifeq ($(DIRS), cint)
	@(cd $(BUILD)/$(PREFIX)/lib/root && \
	   for i in $(ALLLIBS) ; do \
	      b=`basename $$i` ; \
	      ln -fs $(SOVER)/$$b . ; \
	      ln -fs $(SOVER)/$$b.$(SOVER) .; done)
else 
ifneq ($(DIRS), xrootd) 
	@(cd $(BUILD)/$(PREFIX)/lib/root && \
	   for i in $(ALLLIBS) ; do \
	      b=`basename $$i` ; \
	      ln -fs $(SOVER)/$$b.$(SOVER) .; done)
endif
endif # $(DIRS) = cint
endif # $(LIB) = $(DEV)
else  # ! $(LIB)
liblist:
endif # $(LIB)

ifneq ($(DEV),)
PKGHDRS	:= $(ALLHDRS:include/%=$(IPATH)/%) $(DEVLIBS)
devlist:
	@for f in $(filter-out %.cw %.pri, $(PKGHDRS))  ; do echo $$f ; done >> $(OUT)/$(DEV).install
else
devlist:
endif

ifneq ($(BIN),)
PKGEXECS= $(ALLEXECS:bin/%=$(BPATH)/%) 
PKGMANS = $(ALLEXECS:bin/%=$(MPATH)/%.1) 
binlist:
	@for f in $(PKGEXECS)  ; do echo $$f ; done >> $(OUT)/$(BIN).install
	@for f in $(PKGMANS)  ; do echo $$f ; done >> $(OUT)/$(BIN).install
else
binlist:
endif

#
# EOF
#
