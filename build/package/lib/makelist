#!/usr/bin/make -f 
#
#
LPATH	= $(PREFIX)/lib/root
IPATH	= $(PREFIX)/include/root
BPATH	= $(PREFIX)/bin
MPATH   = $(PREFIX)/share/man/man1
SOEXT	= so
MAJOR   = $(shell echo $(VERSION) | tr '.' ' ' | cut -f1 -d' ')
MINOR   = $(shell echo $(VERSION) | tr '.' ' ' | cut -f2 -d' ')
SOVER	= $(MAJOR).$(MINOR)

ifneq ($(DIRS),)
include $(foreach i, $(DIRS), $(i)/Module.mk)
include config/Makefile.config 
endif
ifneq ($(DEV),)
PKGHDRS:=$(shell echo $(ALLHDRS) | sed -e 's,[^ ]*inc/,include/,g' -e 's,include/,usr/include/root/,g')
endif
ifneq ($(PKG),)
PKGLIBS=$(ALLLIBS:%.so=%.so*)
PKGBINS=$(ALLEXECS:bin/%=usr/bin/%)
endif

all:	liblist devlist binlist

ifneq ($(LIB),)
ifneq ($(LIB),$(DEV))
PKGLIBS	:= $(ALLLIBS:$(PREFIX)/lib/root/%.so=$(PREFIX)/lib/root/$(SOVER)/%.so.$(MAJOR)) \
	   $(ALLLIBS:$(PREFIX)/lib/root/%.so=$(PREFIX)/lib/root/$(SOVER)/%.so.$(SOVER)) \
	   $(ALLLIBS:$(PREFIX)/lib/root/%=$(PREFIX)/lib/root/$(SOVER)/%) \
	   $(ALLLIBS:%.so=%.so.$(MAJOR).$(MINOR)) 
DEVLIBS := $(ALLLIBS) 
else
ifneq ($(NOVERS),1)
PKGLIBS	:= $(ALLLIBS) \
	   $(ALLLIBS:$(PREFIX)/lib/root/%.so=$(PREFIX)/lib/root/$(SOVER)/%.so.$(MAJOR)) \
	   $(ALLLIBS:$(PREFIX)/lib/root/%.so=$(PREFIX)/lib/root/$(SOVER)/%.so.$(SOVER)) \
	   $(ALLLIBS:$(PREFIX)/lib/root/%=$(PREFIX)/lib/root/$(SOVER)/%) \
	   $(ALLLIBS:%.so=%.so.$(MAJOR).$(MINOR)) 
else 
ifeq ($(DIRS), xrootd)
XRDLIBS := $(patsubst lib/%, $(LPATH)/%, $(wildcard lib/libXrd*.so))
PKGLIBS	:= $(XRDLIBS) \
	   $(XRDLIBS:$(PREFIX)/lib/root/%=$(PREFIX)/lib/root/$(SOVER)/%)
else
PKGLIBS	:= $(ALLLIBS) \
	   $(ALLLIBS:$(PREFIX)/lib/root/%=$(PREFIX)/lib/root/$(SOVER)/%)
endif
endif 
endif
liblist:
	@for f in $(PKGLIBS)  ; do echo $$f ; done >> $(OUT)/$(LIB).install
else
liblist:
endif

ifneq ($(DEV),)
PKGHDRS	:= $(ALLHDRS:include/%=$(IPATH)/%) $(DEVLIBS)
devlist:
	@for f in $(filter-out %.cw %.pri, $(PKGHDRS))  ; do echo $$f ; done >> $(OUT)/$(DEV).install
else
devlist:
endif

ifneq ($(BIN),)
PKGEXECS:= $(ALLEXECS:bin/%=$(BPATH)/%) 
PKGMANS := $(ALLEXECS:bin/%=$(MPATH)/%.1) 
binlist:
	@for f in $(PKGEXECS)  ; do echo $$f ; done >> $(OUT)/$(BIN).install
	@for f in $(PKGMANS)  ; do echo $$f ; done >> $(OUT)/$(BIN).install
else
binlist:
endif

#
# EOF
#
